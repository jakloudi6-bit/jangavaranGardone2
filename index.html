<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³</title>
    <script src="https://tapi.bale.ai/miniapp.js?3"></script>
    <style>
        body {
            font-family: 'BlinkMacSystemFont', -apple-system, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            background-color: var(--bg-color, #ffffff);
            color: var(--text-color, #000000);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        #app-container {
            width: 100%;
            max-width: 500px;
            text-align: center;
            background-color: var(--secondary-bg-color, #f0f0f0);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        h1 {
            color: var(--accent-text-color, #1e90ff);
        }
        #wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
        }
        #wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 5px solid var(--accent-text-color, #1e90ff);
            background-color: #e0e0e0;
            position: relative;
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .prize-slice {
            position: absolute;
            top: 0;
            left: 50%;
            width: 50%;
            height: 50%;
            transform-origin: 0% 100%;
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0% 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border-right: 1px solid rgba(0, 0, 0, 0.1);
        }
        #spinner-button {
            background-color: var(--button-color, #1e90ff);
            color: var(--button-text-color, #ffffff);
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 20px;
        }
        #spinner-button:hover {
            background-color: var(--link-color, #007bff);
        }
        #spinner-button:disabled {
            background-color: var(--hint-color, #888888);
            cursor: not-allowed;
            transform: none;
        }
        #result-text {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <h1>Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø´Ø§Ù†Ø³ Ø±ÙˆØ²Ø§Ù†Ù‡</h1>
        <div id="wheel-container">
            <div id="wheel"></div>
        </div>
        <p id="result-text">Ø¨Ø±Ø§ÛŒ Ú†Ø±Ø®Ø§Ù†Ø¯Ù† Ú¯Ø±Ø¯ÙˆÙ†Ù‡ØŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯.</p>
        <button id="spinner-button" onclick="spinWheel()">Ø¨Ú†Ø±Ø®Ø§Ù†</button>
    </div>

    <script>
        const rewards = [
            { id: 1, text: "500 Ø·Ù„Ø§ ğŸ’°", value: 500, type: 'gold' },
            { id: 2, text: "1000 ØºØ°Ø§ ğŸ–", value: 1000, type: 'food' },
            { id: 3, text: "50 Ø§Ù„Ù…Ø§Ø³ ğŸ’", value: 50, type: 'diamond' },
            { id: 4, text: "2000 Ø¨Ù„ÙˆÚ© ğŸ§±", value: 2000, type: 'blocks' },
            { id: 5, text: "5 JNG ğŸª™", value: 5, type: 'jng' },
            { id: 6, text: "Ù‡ÛŒÚ†ÛŒ ğŸ˜”", value: 0, type: 'none' }
        ];

        const wheel = document.getElementById('wheel');
        const spinnerButton = document.getElementById('spinner-button');
        const resultText = document.getElementById('result-text');
        
        let spinResult = null;

        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ú¯Ø±Ø¯ÙˆÙ†Ù‡
        function renderWheel() {
            const sliceCount = rewards.length;
            const sliceDeg = 360 / sliceCount;
            rewards.forEach((reward, index) => {
                const slice = document.createElement('div');
                slice.className = 'prize-slice';
                slice.style.transform = `rotate(${sliceDeg * index}deg) skewY(-60deg)`;
                slice.style.backgroundColor = `hsl(${sliceDeg * index}, 70%, 50%)`;
                slice.style.color = 'white';
                slice.style.fontSize = '12px';
                slice.style.fontWeight = 'bold';
                slice.style.padding = '5px';
                
                const textSpan = document.createElement('span');
                textSpan.style.transform = `skewY(60deg) rotate(${sliceDeg / 2}deg)`;
                textSpan.innerText = reward.text;
                slice.appendChild(textSpan);
                wheel.appendChild(slice);
            });
        }
        
        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† ØªÙ…
        function setTheme(isDark) {
            const root = document.documentElement;
            if (isDark) {
                root.style.setProperty('--bg-color', window.Bale.WebApp.themeParams.bg_color || '#121212');
                root.style.setProperty('--text-color', window.Bale.WebApp.themeParams.text_color || '#e0e0e0');
                root.style.setProperty('--secondary-bg-color', window.Bale.WebApp.themeParams.secondary_bg_color || '#1e1e1e');
                root.style.setProperty('--accent-text-color', window.Bale.WebApp.themeParams.accent_text_color || '#bb86fc');
                root.style.setProperty('--button-color', window.Bale.WebApp.themeParams.button_color || '#bb86fc');
                root.style.setProperty('--button-text-color', window.Bale.WebApp.themeParams.button_text_color || '#000000');
                root.style.setProperty('--link-color', window.Bale.WebApp.themeParams.link_color || '#2196f3');
                root.style.setProperty('--hint-color', window.Bale.WebApp.themeParams.hint_color || '#999999');
            } else {
                root.style.setProperty('--bg-color', window.Bale.WebApp.themeParams.bg_color || '#ffffff');
                root.style.setProperty('--text-color', window.Bale.WebApp.themeParams.text_color || '#000000');
                root.style.setProperty('--secondary-bg-color', window.Bale.WebApp.themeParams.secondary_bg_color || '#f0f0f0');
                root.style.setProperty('--accent-text-color', window.Bale.WebApp.themeParams.accent_text_color || '#1e90ff');
                root.style.setProperty('--button-color', window.Bale.WebApp.themeParams.button_color || '#1e90ff');
                root.style.setProperty('--button-text-color', window.Bale.WebApp.themeParams.button_text_color || '#ffffff');
                root.style.setProperty('--link-color', window.Bale.WebApp.themeParams.link_color || '#007bff');
                root.style.setProperty('--hint-color', window.Bale.WebApp.themeParams.hint_color || '#888888');
            }
        }
        
        // ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ú†Ø±Ø®Ø§Ù†Ø¯Ù† Ú¯Ø±Ø¯ÙˆÙ†Ù‡
        function spinWheel() {
            spinnerButton.disabled = true;
            resultText.innerText = "Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ú†Ø±Ø®Ø´ Ø§Ø³Øª...";

            // Ø¨Ù‡ Ø³Ø±ÙˆØ± Ø¨Ø§Øª Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯Ù‡ Ú©Ù‡ Ú¯Ø±Ø¯ÙˆÙ†Ù‡ Ú†Ø±Ø®ÛŒØ¯Ù‡
            window.Bale.WebApp.sendData(JSON.stringify({
                action: 'spin_request',
                user_id: window.Bale.WebApp.initDataUnsafe.user.id
            }));
            
            // Ø¯Ø± Ø­Ø§Ù„Øª ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ÛŒØ¯ Ù…Ù†ØªØ¸Ø± Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ± Ø¨Ø§Ø´ÛŒÙ… Ú©Ù‡ Ù†ØªÛŒØ¬Ù‡ Ú†ÛŒ Ø¨ÙˆØ¯Ù‡
            // Ø§Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡ØŒ Ø§Ø² ÛŒÚ© Ù†ØªÛŒØ¬Ù‡ ØªØµØ§Ø¯ÙÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒ Ú©Ù†ÛŒÙ…
            const randomIndex = Math.floor(Math.random() * rewards.length);
            const selectedReward = rewards[randomIndex];
            spinResult = selectedReward;

            const deg = 360 * 5 + (360 / rewards.length) * (rewards.length - randomIndex - 0.5);
            wheel.style.transform = `rotate(-${deg}deg)`;

            wheel.addEventListener('transitionend', () => {
                setTimeout(() => {
                    showResult();
                }, 500);
            }, { once: true });
        }

        function showResult() {
            resultText.innerText = `ØªØ¨Ø±ÛŒÚ©! Ø´Ù…Ø§ Ø¨Ø±Ù†Ø¯Ù‡ ${spinResult.text} Ø´Ø¯ÛŒØ¯! ğŸ‰`;
            spinnerButton.style.display = 'none';
        }

        // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¢ÛŒØ§ Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¯Ø± Ø¨Ù„Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù…ÛŒØ´Ù‡ ÛŒØ§ Ù†Ù‡ 
        if (!window.Bale.WebApp.isMiniAppSupported) {
            document.getElementById('app-container').innerHTML = `
                <p>âš ï¸ Ù†Ø³Ø®Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¨Ù„Ù‡ Ø´Ù…Ø§ Ù‚Ø¯ÛŒÙ…ÛŒ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØªØŒ Ø¢Ù† Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯. </p>
            `;
        } else {
            // ÙˆÙ‚ØªÛŒ Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ø¢Ù…Ø§Ø¯Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø´Ø¯ØŒ Ø¨Ù‡ Ø¨Ù„Ù‡ Ø§Ø·Ù„Ø§Ø¹ Ø¨Ø¯Ù‡ 
            window.Bale.WebApp.ready();
            
            // ØªÙ†Ø¸ÛŒÙ… ØªÙ… Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ… Ú©Ø§Ø±Ø¨Ø± 
            setTheme(window.Bale.WebApp.isDarkMode);
            
            // Ù‡Ø± ÙˆÙ‚Øª ØªÙ… Ú©Ø§Ø±Ø¨Ø± Ø¹ÙˆØ¶ Ø´Ø¯ØŒ ØªÙ… Ù…ÛŒÙ†ÛŒâ€ŒØ§Ù¾ Ù‡Ù… Ø¹ÙˆØ¶ Ø´Ù‡ 
            window.Bale.WebApp.onEvent('themeChanged', () => {
                setTheme(window.Bale.WebApp.isDarkMode);
            });
            
            renderWheel();
        }
    </script>
</body>
</html>